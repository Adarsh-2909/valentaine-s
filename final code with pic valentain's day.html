<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Our Love Story</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;1,600&display=swap" rel="stylesheet">
    <style>
        /* All original styles maintained */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background-color: #000; color: #ffffff; font-family: 'Playfair Display', serif; overflow: hidden; height: 100vh; }
        #overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 1000; transition: opacity 1.5s ease, transform 1.5s ease; }
        .slider-area { width: 90%; max-width: 500px; height: 300px; position: relative; display: flex; align-items: center; margin-top: 30px; }
        .target-img { width: 150px; height: 220px; background-size: contain; background-repeat: no-repeat; background-position: center; position: absolute; right: 0; filter: drop-shadow(0 0 15px rgba(255, 71, 87, 0.4)); }
        .drag-img { width: 150px; height: 220px; background-size: contain; background-repeat: no-repeat; background-position: center; position: absolute; left: 0; cursor: grab; touch-action: none; z-index: 1001; filter: drop-shadow(0 0 15px rgba(255, 255, 255, 0.3)); }
        .instruction-text { position: absolute; bottom: 0; width: 100%; text-align: center; font-size: 0.8rem; color: #777; letter-spacing: 2px; text-transform: uppercase; }
        .bg-heart { position: absolute; color: rgba(255, 71, 87, 0.6); pointer-events: none; z-index: 50; animation: moveUpwards linear forwards; }
        @keyframes moveUpwards { 0% { transform: translateY(100vh) scale(0.5); opacity: 0; } 10% { opacity: 0.8; } 100% { transform: translateY(-10vh) scale(1.2); opacity: 0; } }
        #live-counter-overlay { position: fixed; bottom: 40px; width: 100%; text-align: center; font-family: sans-serif; font-size: 0.9rem; color: #f1c40f; text-shadow: 0 0 10px rgba(241, 196, 15, 0.5); z-index: 9999; opacity: 0; transition: opacity 1s ease; pointer-events: none; letter-spacing: 1px; display: none; }
        #fireworks-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 5500; }
        #intro-scene { position: fixed; top: 0; left: 0; width: 100%; height: 100%; display: none; justify-content: center; align-items: center; opacity: 0; transition: opacity 1.2s ease; z-index: 500; }
        .story-text { font-size: 1.5rem; line-height: 1.8; text-align: center; font-style: italic; padding: 20px; }
        #montage-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; display: none; z-index: 100; }
        .memory { position: absolute; width: 100%; height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; opacity: 0; transition: opacity 1.2s ease-in-out; gap: 25px; }
        .memory.active { opacity: 1; }
        .photo-bg { width: 320px; height: 420px; background-size: contain; background-repeat: no-repeat; background-position: center; border-radius: 10px; box-shadow: 0 0 20px rgba(255, 255, 255, 0.1); transform: scale(0.9); transition: transform 4s ease-out; z-index: 101; }
        .active .photo-bg { transform: scale(1); }
        .memory-text { position: relative; z-index: 102; font-size: 1.4rem; text-align: center; padding: 0 40px; text-shadow: 0px 4px 15px rgba(0,0,0,0.9); opacity: 0; transform: translateY(20px); transition: all 1.2s ease 0.3s; }
        .active .memory-text { opacity: 1; transform: translateY(0); }
        #gift-scene { position: fixed; top: 0; left: 0; width: 100%; height: 100%; display: none; justify-content: center; align-items: center; background: radial-gradient(circle, #1a1a1a 0%, #000 100%); z-index: 800; perspective: 1000px; transition: filter 2s ease, opacity 2s ease; }
        #gift-box { position: relative; width: 150px; height: 150px; transform-style: preserve-3d; transform: rotateX(-20deg) rotateY(25deg) translateY(-1000px); transition: transform 1.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); cursor: pointer; }
        #gift-box.drop { transform: rotateX(-20deg) rotateY(25deg) translateY(0); }
        .side { position: absolute; width: 150px; height: 150px; background: #d63031; border: 2px solid #b32626; }
        .side::after { content: ''; position: absolute; background: #f1c40f; width: 30px; height: 100%; left: 50%; transform: translateX(-50%); }
        .front { transform: translateZ(75px); }
        .back { transform: rotateY(180deg) translateZ(75px); }
        .left { transform: rotateY(-90deg) translateZ(75px); }
        .right { transform: rotateY(90deg) translateZ(75px); }
        .bottom { transform: rotateX(-90deg) translateZ(75px); background: #8e1a1a; }
        #envelope { position: absolute; width: 110px; height: 75px; background: #fdfcf0; left: 20px; top: 35px; z-index: 5; display: flex; justify-content: center; align-items: center; border: 1px solid #ddd; transition: transform 2.5s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: 0 0 20px rgba(255,215,0,0); cursor: pointer; }
        #envelope::before { content: ''; position: absolute; top: 0; left: 0; border-left: 55px solid transparent; border-right: 55px solid transparent; border-top: 45px solid #ebe9d8; z-index: 2; }
        #envelope.rise { transform: translateZ(150px) translateY(-180px) rotateX(10deg); box-shadow: 0 10px 40px rgba(255, 215, 0, 0.4); z-index: 2000; animation: floatLetter 3s ease-in-out infinite 2.5s; }
        @keyframes floatLetter { 0% { transform: translateZ(150px) translateY(-180px) rotateX(10deg); } 50% { transform: translateZ(150px) translateY(-200px) rotateX(10deg); } 100% { transform: translateZ(150px) translateY(-180px) rotateX(10deg); } }
        
        #letter-display { 
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0.5); 
            width: 85%; max-width: 400px; height: auto; min-height: 400px; 
            background: #fdfaf0; color: #4a342e; padding: 30px; z-index: 3000; display: none; 
            box-shadow: 0 10px 50px rgba(0,0,0,0.8), inset 0 0 100px rgba(214, 184, 142, 0.2); 
            opacity: 0; transition: all 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.27); 
            border: 1px solid #dcd1b3; border-radius: 2px;
        }
        #letter-display::before { content: ""; position: absolute; top: 10px; left: 10px; right: 10px; bottom: 10px; border: 1px solid #e0d5ba; pointer-events: none; }
        .letter-header { text-align: center; margin-bottom: 20px; font-size: 1.8rem; color: #d63031; }
        #letter-display.active { display: block; opacity: 1; transform: translate(-50%, -50%) scale(1); }
        .letter-text { font-size: 1.1rem; line-height: 1.7; text-align: left; font-style: italic; white-space: pre-wrap; position: relative; z-index: 10; }
        
        #surprise-scene { position: fixed; top: 0; left: 0; width: 100%; height: 100%; display: none; flex-direction: row; justify-content: center; align-items: center; gap: 120px; z-index: 4000; background: #000; opacity: 0; transition: opacity 2s ease; }
        .btn-container { display: flex; flex-direction: column; align-items: center; gap: 25px; transition: opacity 0.6s ease; }
        .surprise-btn { width: 90px; height: 90px; border-radius: 50%; border: none; cursor: pointer; display: flex; justify-content: center; align-items: center; font-size: 2.2rem; transition: transform 0.4s ease; }
        .btn-a { background: radial-gradient(circle, #ffcccc 0%, #ff9999 100%); box-shadow: 0 0 40px rgba(255,153,153,0.6); }
        .btn-b { background: radial-gradient(circle, #ffe6b3 0%, #ffcc66 100%); box-shadow: 0 0 40px rgba(255,204,102,0.6); }
        .surprise-btn:hover { transform: scale(1.15); }
        .btn-text { font-size: 0.8rem; color: #777; letter-spacing: 0.5px; text-align: center; }
        #surprise-result { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 90%; text-align: center; font-size: 1.8rem; font-style: italic; color: #f1c40f; line-height: 1.6; text-shadow: 0 0 15px rgba(241, 196, 15, 0.5); opacity: 0; transition: opacity 1s ease; pointer-events: none; z-index: 4001; }
        #proposal-scene { position: fixed; top: 0; left: 0; width: 100%; height: 100%; display: none; flex-direction: column; justify-content: center; align-items: center; background: #000; z-index: 5000; opacity: 0; transition: opacity 2.5s ease; }
        .proposal-title { font-size: 2.2rem; text-align: center; margin-bottom: 50px; color: #fff; z-index: 5003; }
        .prop-btn-group { position: relative; width: 100%; height: 300px; display: flex; justify-content: center; align-items: center; }
        .prop-btn { padding: 18px 45px; border-radius: 50px; border: none; font-family: 'Playfair Display', serif; font-weight: bold; cursor: pointer; font-size: 1.1rem; }
        .btn-yes { background: #ff4757; color: white; box-shadow: 0 0 30px rgba(255, 71, 87, 0.5); transition: transform 0.3s; z-index: 5002; }
        
        /* Fixed position for No button visibility */
        .btn-no { background: #222; color: #666; position: absolute; transition: all 0.1s ease-out; z-index: 5001; border: 1px solid #444; left: 60%; top: 50%; transform: translateY(-50%); }
        
        #final-message { position: fixed; top: 0; left: 0; width: 100%; height: 100%; display: none; flex-direction: column; justify-content: center; align-items: center; background: #000; z-index: 6000; text-align: center; }
        .fading-text { font-size: 2.5rem; color: #fff; line-height: 1.6; font-weight: bold; }
        .fading-text span { opacity: 0; display: inline-block; animation: pinkLetterFade 2.5s ease forwards; text-shadow: 0 0 15px #ff75a0, 0 0 30px #ff2e78; }
        @keyframes pinkLetterFade { 0% { opacity: 0; filter: blur(10px); transform: translateY(15px); } 100% { opacity: 1; filter: blur(0); transform: translateY(0); } }
        .lid { position: absolute; width: 160px; height: 40px; top: -10px; left: -5px; transform-style: preserve-3d; transition: transform 1.2s ease-in-out, opacity 1s; z-index: 20; }
        .lid-top { position: absolute; width: 160px; height: 160px; background: #e74c3c; transform: rotateX(90deg) translateZ(80px); border: 2px solid #b32626; }
        .lid-side { position: absolute; width: 160px; height: 40px; background: #d63031; border: 2px solid #b32626; }
        .lid-front { transform: translateZ(80px); }
        .lid-back { transform: rotateY(180deg) translateZ(80px); }
        .lid-left { transform: rotateY(-90deg) translateZ(80px); }
        .lid-right { transform: rotateY(90deg) translateZ(80px); }
        .lid.open { transform: translateY(-250px) rotateX(-120deg) rotateZ(30deg); opacity: 0; }
        .tap-message { position: absolute; bottom: 80px; color: #f1c40f; letter-spacing: 2px; font-size: 0.8rem; opacity: 0; transition: 1s; }
    </style>
</head>
<body onclick="handleInteraction()">

    <div id="live-counter-overlay"></div>
    <canvas id="fireworks-canvas"></canvas>

    <audio id="bg-music">
        <source src="C:/Users/WIN10/OneDrive/Desktop/DL_LABELS/valentine/Theri_-_Bus_Love_Bgm_128kbps.mp4" type="audio/mpeg">
    </audio>

    <audio id="gift-open-sound">
        <source src="https://www.soundjay.com/misc/sounds/magic-chime-01.mp3" type="audio/mpeg">
    </audio>

    <div id="overlay">
        <p style="font-size: 1.2rem; color: #fff; font-style: italic; margin-bottom: 20px;">Move closer to her...</p>
        <div class="slider-area" id="sliderArea">
            <div class="drag-img" id="dragHandle" style="background-image: url('C:/Users/WIN10/OneDrive/Desktop/DL_LABELS/valentine/aadi2.jpeg');"></div>
            <div class="target-img" style="background-image: url('C:/Users/WIN10/OneDrive/Desktop/DL_LABELS/valentine/aadi1.jpeg');"></div>
            <div class="instruction-text">Slide photos to meet ‚ù§Ô∏è</div>
        </div>
    </div>

    <div id="intro-scene"><p class="story-text">‚ÄúEvery love story is beautiful‚Ä¶<br>But ours is my favorite ‚ù§Ô∏è‚Äù</p></div>
    <div id="montage-container">
        <div class="memory active"><div class="photo-bg" style="background-image: url('C:/Users/WIN10/OneDrive/Desktop/DL_LABELS/valentine/bhuvi1.jpeg');"></div><h2 class="memory-text">‚ÄúThe day I first saw you‚Ä¶‚Äù</h2></div>
        <div class="memory"><div class="photo-bg" style="background-image: url('C:/Users/WIN10/OneDrive/Desktop/DL_LABELS/valentine/bhuvi2.jpeg');"></div><h2 class="memory-text">‚ÄúThe moment I knew‚Ä¶‚Äù</h2></div>
        <div class="memory"><div class="photo-bg" style="background-image: url('C:/Users/WIN10/OneDrive/Desktop/DL_LABELS/valentine/bhuvi3.jpeg');"></div><h2 class="memory-text">‚ÄúEvery smile of yours is my favorite view‚Äù</h2></div>
        <div class="memory"><div class="photo-bg" style="background-image: url('C:/Users/WIN10/OneDrive/Desktop/DL_LABELS/valentine/bhuvi4.jpeg');"></div><h2 class="memory-text">‚ÄúI didn‚Äôt know what love was until you became my comfort‚Äù</h2></div>
        <div class="memory"><div class="photo-bg" style="background-image: url('C:/Users/WIN10/OneDrive/Desktop/DL_LABELS/valentine/bhuvi5.jpeg');"></div><h2 class="memory-text">‚ÄúYou‚Äôre not just part of my life‚Äîyou‚Äôre the reason it feels complete‚Äù</h2></div>
        <div class="memory"><div class="photo-bg" style="background-image: url('C:/Users/WIN10/OneDrive/Desktop/DL_LABELS/valentine/bhuvi6.jpeg');"></div><h2 class="memory-text">‚ÄúYou‚Äôre my calm in all the chaos‚Äù</h2></div>
        <div class="memory"><div class="photo-bg" style="background-image: url('C:/Users/WIN10/OneDrive/Desktop/DL_LABELS/valentine/bhuvi7.jpeg');"></div><h2 class="memory-text">‚ÄúI don‚Äôt need perfection. I just need you‚Äù</h2></div>
    </div>

    <div id="gift-scene">
        <div id="gift-box">
            <div id="envelope" onclick="showLetter(event)"><span style="z-index: 10; font-size: 1.5rem; margin-top: 15px;">‚ù§Ô∏è</span></div>
            <div class="side front"></div><div class="side back"></div><div class="side left"></div><div class="side right"></div><div class="side bottom"></div>
            <div class="lid"><div class="lid-top"></div><div class="lid-side lid-front"></div><div class="lid-side lid-back"></div><div class="lid-side lid-left"></div><div class="lid-side lid-right"></div></div>
        </div>
        <p class="tap-message">Tap to open your gift</p>
    </div>

    <div id="letter-display">
        <div class="letter-header">To My Love</div>
        <div id="typewriter" class="letter-text"></div>
        <p id="close-hint" style="text-align: center; font-size: 0.7rem; color: #999; margin-top: 20px; opacity: 0; transition: 1s;">(Tap anywhere to close)</p>
    </div>

    <div id="surprise-scene">
        <div class="btn-container" id="cont-a"><button class="surprise-btn btn-a" onclick="missMe(event)">üíï</button><span class="btn-text">When you miss me</span></div>
        <div class="btn-container" id="cont-b"><button class="surprise-btn btn-b" onclick="whyLove(event)">üòå</button><span class="btn-text">Why I love you?</span></div>
        <div id="surprise-result"></div>
    </div>
    
    <div id="proposal-scene">
        <h1 class="proposal-title" id="prop-q">So‚Ä¶<br>Will you be my Valentine? üíñ</h1>
        <div class="prop-btn-group">
            <button class="prop-btn btn-yes" id="yes-btn" onclick="accepted(event)">üíò YES</button>
            <button class="prop-btn btn-no" id="no-btn" onmouseover="moveNo()" ontouchstart="moveNo()">No</button>
        </div>
    </div>
    
    <div id="final-message"><div class="fading-text" id="final-text-target"></div></div>

    <script>
        let step = 0;
        let currentMemory = 0;
        let isTyping = false;
        let interactionCount = 0;
        let globalTapCount = 0; 
        let heartInterval;
        const music = document.getElementById('bg-music');
        const giftSound = document.getElementById('gift-open-sound');
        const memories = document.querySelectorAll('.memory');
        const message = "I wanted to tell you how much you mean to me. Every moment spent with you is a treasure. Thank you for being my person.\n\nForever Yours ‚ù§Ô∏è";

        music.addEventListener('timeupdate', function() {
            if (this.currentTime > (this.duration - 0.4)) {
                this.currentTime = 0;
                this.play();
            }
        });

        function fadeOutMusic() {
            music.ontimeupdate = null; 
            let fadeOutInterval = setInterval(() => {
                if (music.volume > 0.02) {
                    music.volume -= 0.02;
                } else {
                    music.pause();
                    music.volume = 1; 
                    clearInterval(fadeOutInterval);
                }
            }, 120);
        }

        const dragHandle = document.getElementById('dragHandle');
        const sliderArea = document.getElementById('sliderArea');
        let isDragging = false;
        let startX;

        dragHandle.addEventListener('mousedown', startDrag);
        dragHandle.addEventListener('touchstart', startDrag);
        window.addEventListener('mousemove', drag);
        window.addEventListener('touchmove', drag);
        window.addEventListener('mouseup', endDrag);
        window.addEventListener('touchend', endDrag);

        function startDrag(e) { isDragging = true; startX = (e.pageX || e.touches[0].pageX) - dragHandle.offsetLeft; }
        function drag(e) {
            if (!isDragging) return;
            e.preventDefault();
            const x = (e.pageX || e.touches[0].pageX);
            const walk = x - startX;
            const maxDrag = sliderArea.offsetWidth - dragHandle.offsetWidth; 
            if (walk >= 0 && walk <= maxDrag) {
                dragHandle.style.left = walk + 'px';
                if (walk > maxDrag * 0.85) { isDragging = false; startStory(); }
            }
        }
        function endDrag() {
            if (!isDragging) return;
            isDragging = false;
            dragHandle.style.transition = 'left 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275)';
            dragHandle.style.left = '0px';
            setTimeout(() => dragHandle.style.transition = '', 400);
        }

        function startStory() {
            music.play();
            document.getElementById('overlay').style.opacity = '0';
            setTimeout(() => {
                document.getElementById('overlay').style.display = 'none';
                const intro = document.getElementById('intro-scene');
                intro.style.display = 'flex';
                setTimeout(() => intro.style.opacity = '1', 50);
                
                setTimeout(() => {
                    intro.style.opacity = '0';
                    setTimeout(() => {
                        intro.style.display = 'none';
                        document.getElementById('montage-container').style.display = 'block';
                        step = 2; 
                        heartInterval = setInterval(createFloatingHeart, 400);
                        runAutoMontage();
                    }, 1200);
                }, 2500); 

            }, 1000);
        }

        function runAutoMontage() {
            const interval = setInterval(() => {
                if (currentMemory < memories.length - 1) { 
                    memories[currentMemory].classList.remove('active'); 
                    currentMemory++; 
                    memories[currentMemory].classList.add('active'); 
                    if (currentMemory === memories.length - 1) {
                        setTimeout(fadeOutMusic, 1000); 
                    }
                } else { 
                    clearInterval(interval); 
                    clearInterval(heartInterval); 
                    showGift(); 
                }
            }, 3500); 
        }

        const canvas = document.getElementById('fireworks-canvas');
        const ctx = canvas.getContext('2d');
        let particles = [];
        function resizeCanvas() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
        window.addEventListener('resize', resizeCanvas); resizeCanvas();

        class Particle {
            constructor(x, y, color, type) {
                this.x = x; this.y = y; this.color = color; this.type = type; 
                this.angle = Math.random() * Math.PI * 2; this.velocity = Math.random() * 6 + 2;
                this.friction = 0.95; this.gravity = 0.1; this.opacity = 1;
            }
            draw() {
                ctx.globalAlpha = this.opacity;
                if(this.type === 'heart') { ctx.font = '20px serif'; ctx.fillText('‚ù§Ô∏è', this.x, this.y); } 
                else { ctx.beginPath(); ctx.arc(this.x, this.y, 2, 0, Math.PI * 2); ctx.fillStyle = this.color; ctx.fill(); }
            }
            update() { this.x += Math.cos(this.angle) * this.velocity; this.y += Math.sin(this.angle) * this.velocity + this.gravity; this.opacity -= 0.01; }
        }

        function triggerExplosion() {
            const colors = ['#ff4757', '#ff75a0', '#ff2e78', '#ffffff', '#f1c40f'];
            for(let i = 0; i < 100; i++) { particles.push(new Particle(window.innerWidth/2, window.innerHeight/2, colors[Math.floor(Math.random()*colors.length)], Math.random()>0.7?'heart':'spark')); }
            animateFireworks();
        }

        function animateFireworks() {
            if(particles.length === 0) return;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            particles.forEach((p, i) => { p.update(); p.draw(); if(p.opacity <= 0) particles.splice(i, 1); });
            requestAnimationFrame(animateFireworks);
        }

        function createFloatingHeart() {
            const heart = document.createElement('div'); heart.classList.add('bg-heart'); heart.innerHTML = '‚ù§Ô∏è';
            heart.style.left = Math.random() * 100 + 'vw'; heart.style.fontSize = (Math.random() * 15 + 10) + 'px';
            const duration = Math.random() * 3 + 4; heart.style.animationDuration = duration + 's';
            document.body.appendChild(heart); setTimeout(() => heart.remove(), duration * 1000);
        }

        function handleInteraction() {
            if(document.getElementById('final-message').style.display === 'flex') {
                globalTapCount++;
                if(globalTapCount >= 5) { 
                    document.getElementById('live-counter-overlay').style.display = 'block'; 
                    setTimeout(() => document.getElementById('live-counter-overlay').style.opacity = '1', 10);
                    updateLiveCounter(); if(!window.counterTimer) window.counterTimer = setInterval(updateLiveCounter, 1000); 
                }
                return;
            }
            if(document.getElementById('letter-display').classList.contains('active') && !isTyping) {
                document.getElementById('letter-display').classList.remove('active');
                setTimeout(() => { document.getElementById('letter-display').style.display = 'none'; showSurpriseSection(); }, 1000);
                return;
            }
            if (step === 3) { openGift(); }
        }

        function updateLiveCounter() {
            const startDate = new Date("July 23, 2023 00:00:00");
            const now = new Date(); const diff = now - startDate;
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff / (1000 * 60 * 60)) % 24);
            const minutes = Math.floor((diff / (1000 * 60)) % 60);
            const seconds = Math.floor((diff / 1000) % 60);
            document.getElementById('live-counter-overlay').innerHTML = `Time since July 23, 2023: ${days}d ${hours}h ${minutes}m ${seconds}s ‚ù§Ô∏è`;
        }

        function showGift() {
            document.getElementById('montage-container').style.opacity = '0';
            setTimeout(() => { document.getElementById('montage-container').style.display = 'none'; document.getElementById('gift-scene').style.display = 'flex'; setTimeout(() => { document.getElementById('gift-box').classList.add('drop'); document.querySelector('.tap-message').style.opacity = '1'; step = 3; }, 500); }, 2000);
        }

        function openGift() {
            step = 4; giftSound.play(); document.querySelector('.lid').classList.add('open');
            setTimeout(() => { document.getElementById('envelope').classList.add('rise'); }, 800);
        }

        function showLetter(event) {
            if(step === 4) {
                event.stopPropagation(); const letter = document.getElementById('letter-display'); document.getElementById('typewriter').innerHTML = "";
                letter.style.display = 'block'; setTimeout(() => letter.classList.add('active'), 10); setTimeout(() => { startTypewriter(message); }, 1000);
            }
        }

        function startTypewriter(text) {
            isTyping = true; let i = 0; const container = document.getElementById('typewriter');
            function type() { if (i < text.length) { container.innerHTML += text.charAt(i); i++; setTimeout(type, 50); } else { isTyping = false; document.getElementById('close-hint').style.opacity = "1"; } }
            type();
        }

        function showSurpriseSection() {
            const surprise = document.getElementById('surprise-scene'); document.getElementById('gift-scene').style.filter = "blur(20px) brightness(0.2)";
            surprise.style.display = 'flex'; setTimeout(() => surprise.style.opacity = '1', 100);
        }

        function triggerCinematicMessage(text) {
            interactionCount++; const result = document.getElementById('surprise-result');
            document.getElementById('cont-a').style.opacity = '0'; document.getElementById('cont-b').style.opacity = '0';
            setTimeout(() => { result.innerHTML = text; result.style.opacity = '1'; setTimeout(() => { result.style.opacity = '0'; if(interactionCount >= 2) showProposal(); else { document.getElementById('cont-a').style.opacity = '1'; document.getElementById('cont-b').style.opacity = '1'; } }, 3500); }, 600);
        }

        function missMe(e) { e.stopPropagation(); triggerCinematicMessage("‚ÄúI miss you more. Always.‚Äù"); }
        function whyLove(e) { e.stopPropagation(); triggerCinematicMessage("The way you care,<br>The way you make me feel at home"); }
        function showProposal() { const prop = document.getElementById('proposal-scene'); prop.style.display = 'flex'; setTimeout(() => prop.style.opacity = '1', 100); }

        function moveNo() {
            const btn = document.getElementById('no-btn');
            const yesBtn = document.getElementById('yes-btn').getBoundingClientRect();
            const question = document.getElementById('prop-q').getBoundingClientRect();
            
            let newX, newY, tooClose;
            const padding = 30;

            let attempts = 0;
            do {
                tooClose = false;
                newX = Math.random() * (window.innerWidth - btn.offsetWidth - 20) + 10;
                newY = Math.random() * (window.innerHeight - btn.offsetHeight - 20) + 10;

                if (newX < question.right + padding && newX + btn.offsetWidth > question.left - padding && 
                    newY < question.bottom + padding && newY + btn.offsetHeight > question.top - padding) {
                    tooClose = true;
                }
                if (newX < yesBtn.right + padding && newX + btn.offsetWidth > yesBtn.left - padding && 
                    newY < yesBtn.bottom + padding && newY + btn.offsetHeight > yesBtn.top - padding) {
                    tooClose = true;
                }
                attempts++;
                if(attempts > 50) break;
            } while (tooClose);

            btn.style.left = newX + 'px';
            btn.style.top = newY + 'px';
        }

        function accepted(e) { e.stopPropagation(); triggerExplosion(); document.getElementById('proposal-scene').style.opacity = '0'; setTimeout(() => { document.getElementById('proposal-scene').style.display = 'none'; document.getElementById('final-message').style.display = 'flex'; animateFinalLetters("‚ù§Ô∏è I love you\nHappy Valentine's Day Bangariiii.....‚ù§Ô∏è"); }, 1500); }

        function animateFinalLetters(fullText) {
            const container = document.getElementById('final-text-target'); const chars = fullText.split("");
            chars.forEach((char, index) => { const span = document.createElement("span"); if (char === "\n") container.appendChild(document.createElement("br")); else { span.textContent = char === " " ? "\u00A0" : char; span.style.animationDelay = (index * 0.08) + "s"; container.appendChild(span); } });
        }
    </script>
</body>
</html>